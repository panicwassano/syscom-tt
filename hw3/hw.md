## Схемы событий

- [candidate.v1
](./formal.json) — схема формального события
- [assessment.assigned.v1
](./business.json) — схема бизнес события

## Миграции коммуникаций
### Переход формальной синхронной на асинхронную event-driven
#### COMM-010
1. Добавляем событие в Schema Registry.
2. Добавляем в сервисы `Найма` и `Бонусов` консьюмеры, которые будут сохранять данные о новых менеджерах. Дубли убираем через `SQL` конструкцию `ON CONFLICT (manager_replication_id) DO NOTHING`
3. В сервисе `Заданий` добавляем продьюсер и начинаем продьюсить событие о новом менеджере, появившимся в системе.
4. Выключаем синхронную коммуникацию по фиче-флагу, убеждаемся, что проблем нет.
5. Если в сервисах `Найма` и `Бонусов` не хватает данных о менеджерах, то пишем скрипт, который возьмет данные менеджеров из БД `Заданий` и по каждому отправит формальное событие `ManagerCreated`.
6. Чистим код системы от старой коммуникации.

### Переход формальной асинхронной event-driven на синхронную
#### COMM-060
1. В сервис `Найма` добавляем новый endpoint для получения данных о рейтинге задания.
2. Переписываем бизнес-логику в сервисе `Бонусов` на синхронные вызовы в сервис `Найма`. Проверяем, что все работает, используем фиче-флаги.
3. Отключаем продьюсер в сервисе `Найма`.
4. Ждем, когда все консьюмеры обработают все данные из брокера.
5. Удаляем код консьюмеров всех сервисов потребителей.
6. Удаляем таблицу с данными, которые были получены из событий или пулл-процессинга.
7. Удаляем топик из брокера.
8. Чистим систему от старых метрик, кода, таблиц в базе.

### Переход функциональной синхронной на асинхронную event-driven
#### COMM-040
1. Добавляем событие в Schema Registry.
2. Добавляем коньсюмер в сервис `Бонусов`, бизнес-логику не добавляем, пишем данные в лог.
3. Добавляем продьюсер в сервисе `Найма` и продьюсим событие `SolutionCompleted` (задание выполнено успешно).
4. Проверяем, что все работает.
5. Добавляем бизнес-логику в консьюмер, не забываем про фиче-флаги и идемпотентность событий.
6. Отключаем синхронные запросы в сервис `Бонусов`.
7. Чистим систему от старых метрик, кода.
